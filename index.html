<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Korzinka • TMS • Реестр отгрузок</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config={theme:{extend:{colors:{brand:{primary:'#C8102E',soft:'#FFF5F5',ink:'#1F2937'}},boxShadow:{smooth:'0 6px 18px rgba(0,0,0,.08)'}}}};
</script>
<style>
.brand-gradient{background:linear-gradient(90deg,#C8102E 0%,#FF3B30 100%)}
.sticky-th th{position:sticky;top:0;background:#f8fafc;z-index:2}
.sticky-left{position:sticky;left:0;background:#fff;z-index:3}
.cell{min-width:160px}
</style>
</head>
<body class="bg-brand-soft text-brand-ink">
<div id="root"></div>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel" data-presets="env,react">
const {useState,useEffect}=React;

async function load(url){const r=await fetch(url,{cache:'no-store'});return r.json();}

function Cell({col,value,onChange}){
 if(col.type==='select')
  return <select className="border rounded px-2 py-1 cell" value={value||''} onChange={e=>onChange(e.target.value)}>
    <option value="">—</option>{col.options.map(o=><option key={o}>{o}</option>)}</select>;
 if(col.type==='date') return <input type="date" className="border rounded px-2 py-1 cell" value={value||''} onChange={e=>onChange(e.target.value)}/>;
 if(col.type==='time') return <input type="time" className="border rounded px-2 py-1 cell" value={value||''} onChange={e=>onChange(e.target.value)}/>;
 if(col.type==='number') return <input type="number" className="border rounded px-2 py-1 cell" value={value||''} onChange={e=>onChange(e.target.value)}/>;
 return <input className="border rounded px-2 py-1 cell" value={value||''} onChange={e=>onChange(e.target.value)}/>;
}

function App(){
 const [schema,setSchema]=useState([]);
 const [rows,setRows]=useState([]);

 useEffect(()=>{(async()=>{
  setSchema(await load('./schema.json'));
  const d=await load('./data.json');
  setRows(d.map((r,i)=>({_id:i+1,...r})));
 })()},[]);

 return (
 <div>
  <header className="brand-gradient text-white">
   <div className="max-w-7xl mx-auto px-4 py-5">
    <div className="text-xl font-semibold">Korzinka • TMS</div>
    <div className="opacity-90">Реестр отгрузок / доставок</div>
   </div>
  </header>

  <main className="max-w-[1500px] mx-auto px-4 py-6">
   <div className="bg-white rounded-2xl shadow-smooth overflow-auto max-h-[75vh]">
    <table className="text-sm">
     <thead className="sticky-th border-b">
      <tr>
       <th className="px-3 py-2 sticky-left">#</th>
       {schema.map(c=><th key={c.key} className="px-3 py-2 whitespace-normal min-w-[180px]">{c.label}</th>)}
      </tr>
     </thead>
     <tbody>
      {rows.map(r=>(
       <tr key={r._id} className="border-b hover:bg-slate-50">
        <td className="px-3 py-2 sticky-left font-medium">Row {r._id}</td>
        {schema.map(c=>(
         <td key={c.key} className="px-3 py-2">
          <Cell col={c} value={r[c.key]} onChange={v=>{
            setRows(prev=>prev.map(x=>x._id===r._id?{...x,[c.key]:v}:x));
          }}/>
         </td>
        ))}
       </tr>
      ))}
     </tbody>
    </table>
   </div>
  </main>
 </div>
 );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
